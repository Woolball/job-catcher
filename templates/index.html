<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Search Ranker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="container mt-5">
        <div class="card p-4">
            <h1 class="text-center mb-4">Job Search Ranker</h1>
            <p class="text-center">You can either upload your CV and parameters as files or fill out the form below.</p>
            <form id="searchForm" method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="cv_file" class="form-label">Upload CV File (.txt):</label>
                    <input type="file" id="cv_file" name="cv_file" class="form-control">
                </div>

                <div class="mb-3">
                    <label for="params_file" class="form-label">Upload Parameters File (.json):</label>
                    <input type="file" id="params_file" name="params_file" class="form-control">
                </div>

                <hr>

                <div class="mb-3">
                    <label for="cv_text" class="form-label">Or Paste your CV text here:</label>
                    <textarea id="cv_text" name="cv_text" rows="6" class="form-control">{{ request.form.get('cv_text', '') }}</textarea>
                </div>

                <div class="mb-3">
                    <label for="search_terms" class="form-label">Search Terms (comma-separated):</label>
                    <input type="text" id="search_terms" name="search_terms" class="form-control" value="{{ request.form.get('search_terms', '') }}">
                </div>

                <div class="mb-3">
                    <label for="keywords" class="form-label">Skill-Matching Keywords/Keyphrases (comma-separated):</label>
                    <input type="text" id="keywords" name="keywords" class="form-control" value="{{ request.form.get('keywords', '') }}">
                </div>

                <div class="mb-3">
                    <label for="time_window" class="form-label">Search Time Window (days):</label>
                    <input type="number" id="time_window" name="time_window" class="form-control" value="{{ request.form.get('time_window', '') }}">
                </div>

                <div class="mb-3">
                    <label for="location" class="form-label">Location (City or Country):</label>
                    <input type="text" id="location" name="location" class="form-control" value="{{ request.form.get('location', '') }}">
                </div>

                <div class="mb-3">
                    <label for="distance" class="form-label">Distance from Location (km):</label>
                    <input type="number" id="distance" name="distance" class="form-control" value="{{ request.form.get('distance', '') }}">
                </div>

                <button id="searchButton" type="submit" class="btn btn-primary w-100" disabled>
                    <span id="buttonText">Search</span>
                    <span id="spinner" class="spinner-border spinner-border-sm ms-2" role="status" aria-hidden="true"></span>
                </button>
            </form>
        </div>
    </div>

    <script>
        function checkFormFields() {
            const fields = document.querySelectorAll("#cv_text, #search_terms, #keywords, #time_window, #location, #distance, #results_wanted");
            const allFilled = Array.from(fields).every(input => input.value.trim() !== "") ||
                              document.getElementById("cv_file").files.length > 0 ||
                              document.getElementById("params_file").files.length > 0;
            document.getElementById("searchButton").disabled = !allFilled;
        }

        document.querySelectorAll("#cv_text, #search_terms, #keywords, #time_window, #location, #distance, #results_wanted")
            .forEach(input => input.addEventListener("input", checkFormFields));

        document.getElementById('cv_file').addEventListener("change", checkFormFields);
        document.getElementById('params_file').addEventListener("change", checkFormFields);

        document.getElementById('searchForm').onsubmit = function() {
            document.getElementById('spinner').style.display = 'inline-block';
            document.getElementById('buttonText').textContent = 'Searching...';
            document.getElementById('searchButton').disabled = true;
        };
    </script>
</body>
</html>